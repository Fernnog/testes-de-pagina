<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal Pérola Rara</title>
    
    <!-- PWA Configurações -->
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#ecd5d1"> <!-- Cor do Splash Screen -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="icon" href="assets/images/favicon.ico" type="image/x-icon">
    
    <!-- Fontes: Adicionada Dancing Script para títulos e slogan -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

    <!-- CSS Unificados -->
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/orcamentos.css">
    <link rel="stylesheet" href="assets/css/precificacao.css">

    <!-- Bibliotecas Externas -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

    <!-- Scripts Modulares -->
    <script type="module" src="assets/js/main.js"></script>
    <script type="module" src="assets/js/orcamentos.js"></script>
    <script type="module" src="assets/js/precificacao.js"></script>
</head>
<body>

    <!-- =========================================
         TELA 1: LOGIN CENTRALIZADO
    ========================================= -->
    <section id="auth-screen">
        <div class="auth-container">
            <div class="auth-form">
                <div class="logo-container">
                    <img src="assets/images/logo_perola_rara.png" alt="Logo Pérola Rara" id="logo-login" style="max-width: 150px; display:block; margin: 0 auto;">
                    <!-- ALTERAÇÃO: Nome da empresa adicionado abaixo do logo -->
                    <h1 class="login-brand-name">Pérola Rara</h1>
                </div>
                <h2>Acesso ao Portal</h2>
                
                <div class="form-group">
                    <label for="email">Email:</label>
                    <input type="email" id="email" name="email" placeholder="Digite seu email">
                </div>
                <div class="form-group">
                    <label for="password">Senha:</label>
                    <input type="password" id="password" name="password" placeholder="Digite sua senha">
                </div>
                <div class="auth-buttons">
                    <button type="button" id="loginBtn">Entrar</button>
                </div>
                <p id="auth-message" class="auth-message"></p>
                <!-- Frase de efeito removida daqui para manter o login limpo e focada no Splash -->
            </div>
        </div>
    </section>

    <!-- =========================================
         NOVA TELA: SPLASH SCREEN (Transição)
    ========================================= -->
    <section id="splash-screen" style="display: none;">
        <div class="splash-content">
            <img src="assets/images/logo_perola_rara.png" alt="Logo Pérola Rara" class="splash-logo">
            <p class="splash-slogan">"Onde a arte se encontra com o amor em cada detalhe."</p>
        </div>
    </section>

    <!-- =========================================
         TELA 2: HUB (MENU PRINCIPAL) - NOVO DESIGN
    ========================================= -->
    <section id="hub-screen" style="display: none;">
        <header class="hub-header">
            <div class="logo-wrapper">
                <img src="assets/images/logo_perola_rara.png" alt="Logo Pérola Rara">
            </div>
            <div class="welcome-text">
                <h1>Bem-vindo(a) ao Atelier</h1>
                <p class="user-badge">Logado como: <span id="user-email-display">...</span></p>
                <p class="instruction">Selecione o módulo para iniciar seus trabalhos:</p>
            </div>
        </header>

        <div class="hub-cards-container">
            <!-- Cartão 1: Orçamentos -->
            <div class="hub-card" id="btn-go-orcamentos">
                <div class="card-decoration"></div>
                <div class="card-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
                        <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
                        <path d="M9 14h6"></path>
                        <path d="M9 10h6"></path>
                        <path d="M9 18h6"></path>
                    </svg>
                </div>
                <h3>Gestão de Pedidos</h3>
                <p>Gerencie clientes, crie orçamentos personalizados e controle a fila de produção.</p>
                <div class="card-footer">
                    <span class="card-action">Acessar Módulo &rarr;</span>
                </div>
            </div>

            <!-- Cartão 2: Precificação -->
            <div class="hub-card" id="btn-go-precificacao">
                <div class="card-decoration"></div>
                <div class="card-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="4" y="2" width="16" height="20" rx="2" ry="2"></rect>
                        <line x1="8" y1="6" x2="16" y2="6"></line>
                        <line x1="16" y1="14" x2="16" y2="14"></line>
                        <line x1="12" y1="14" x2="12" y2="14"></line>
                        <line x1="8" y1="14" x2="8" y2="14"></line>
                        <line x1="16" y1="18" x2="16" y2="18"></line>
                        <line x1="12" y1="18" x2="12" y2="18"></line>
                        <line x1="8" y1="18" x2="8" y2="18"></line>
                    </svg>
                </div>
                <h3>Precificação</h3>
                <p>Calcule custos de materiais, mão de obra e defina o valor justo das suas peças.</p>
                <div class="card-footer">
                    <span class="card-action">Acessar Módulo &rarr;</span>
                </div>
            </div>
        </div>

        <div class="hub-footer-actions">
            <button id="hubLogoutBtn" class="btn-logout-ghost">Desconectar</button>
        </div>
    </section>

    <!-- =========================================
         TELA 3: MÓDULO ORÇAMENTOS
    ========================================= -->
    <section id="module-orcamentos" style="display: none;">
        <button class="btn-back-hub">⬅ Voltar ao Menu</button>
        
        <div class="container">
            <header>
                 <h1>Pérola Rara - Gestão de Pedidos</h1>
                 <nav>
                    <ul>
                        <li><a href="#" data-pagina="form-orcamento">Novo Orçamento</a></li>
                        <li><a href="#" data-pagina="orcamentos-gerados">Orçamentos Gerados</a></li>
                        <li><a href="#" data-pagina="lista-pedidos">Pedidos Realizados</a></li>
                        <li><a href="#" data-pagina="relatorio">Relatório</a></li>
                    </ul>
                 </nav>
            </header>
            
            <div id="appContent">
                <!-- PÁGINA 1: FORMULÁRIO DE ORÇAMENTO -->
                <section id="form-orcamento" class="pagina">
                    <h2>Novo Orçamento</h2>
                    <form id="orcamento">
                        <div class="form-row">
                            <div class="form-group"><label>Data:</label><input type="date" id="dataOrcamento"></div>
                            <div class="form-group"><label>Validade:</label><input type="date" id="dataValidade"></div>
                        </div>
                        <div class="form-group"><label>Cliente:</label><input type="text" id="cliente"></div>
                        <div class="form-group"><label>Endereço:</label><input type="text" id="endereco"></div>
                        <div class="form-row">
                            <div class="form-group"><label>Cidade:</label><input type="text" id="cidade"></div>
                            <div class="form-group"><label>Telefone:</label><input type="text" id="telefone"></div>
                        </div>
                        <div class="form-group"><label>Email:</label><input type="email" id="clienteEmail"></div>
                        <div class="form-row">
                            <div class="form-group"><label>Tema:</label><input type="text" id="tema"></div>
                            <div class="form-group"><label>Cores:</label><input type="text" id="cores"></div>
                        </div>

                        <h3>Produtos</h3>
                        <!-- ALTERAÇÃO: Wrapper table-responsive -->
                        <div class="table-responsive">
                            <table id="tabelaProdutos">
                                <thead>
                                    <tr>
                                        <th>Qtd</th>
                                        <th>Descrição</th>
                                        <th>Valor Unit.</th>
                                        <th>Total</th>
                                        <th>Ação</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                        <button type="button" id="btnAddProdutoOrcamento">Adicionar Produto</button>

                        <div class="form-row valores-pedido" style="margin-top: 20px;">
                            <div class="form-group"><label>Frete:</label><input type="text" id="valorFrete" placeholder="R$ 0,00"></div>
                            <div class="form-group"><label>Subtotal:</label><input type="text" id="valorOrcamento" readonly></div>
                            <div class="form-group"><label>Total Final:</label><input type="text" id="total" readonly></div>
                        </div>
                        
                        <div class="form-group">
                            <label>Formas de Pagamento:</label>
                            <label><input type="checkbox" name="pagamento" value="Pix"> Pix</label>
                            <label><input type="checkbox" name="pagamento" value="Cartão"> Cartão</label>
                        </div>
                        <div class="form-group"><label>Observações:</label><textarea id="observacoes"></textarea></div>

                        <button type="button" id="btnGerarOrcamento">Gerar Orçamento</button>
                        <button type="button" id="btnAtualizarOrcamento" style="display:none;">Salvar Alterações</button>
                    </form>
                </section>

                <!-- PÁGINA 2: ORÇAMENTOS GERADOS -->
                <section id="orcamentos-gerados" class="pagina" style="display: none;">
                    <h2>Orçamentos Gerados</h2>
                    <button onclick="filtrarOrcamentos()">Atualizar Lista</button>
                    <!-- ALTERAÇÃO: Wrapper table-responsive -->
                    <div class="table-responsive">
                        <table id="tabela-orcamentos">
                            <thead>
                                <tr><th>Nº</th><th>Data</th><th>Cliente</th><th>Total</th><th>Pedido?</th><th>Ações</th></tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </section>

                <!-- PÁGINA 3: PEDIDOS -->
                <section id="lista-pedidos" class="pagina" style="display: none;">
                    <h2>Pedidos Realizados</h2>
                    <button onclick="filtrarPedidos()">Atualizar Lista</button>
                    <!-- ALTERAÇÃO: Wrapper table-responsive -->
                    <div class="table-responsive">
                        <table id="tabela-pedidos">
                            <thead>
                                <tr><th>Nº</th><th>Data</th><th>Cliente</th><th>Total</th><th>Ações</th></tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </section>
                
                <!-- PÁGINA: EDIÇÃO DE PEDIDO -->
                <section id="form-edicao-pedido" class="pagina" style="display: none;">
                    <h2>Editar Pedido</h2>
                    <input type="hidden" id="dataPedidoEdicao">
                    <div class="form-group"><label>Cliente:</label><input type="text" id="clienteEdicao"></div>
                    <div class="form-group"><label>Entrega:</label><input type="date" id="dataEntregaEdicao"></div>
                    <div class="form-group"><label>Endereço:</label><input type="text" id="enderecoEdicao"></div>
                    <div class="form-group"><label>Tema:</label><input type="text" id="temaEdicao"></div>
                    <div class="form-group"><label>Cidade:</label><input type="text" id="cidadeEdicao"></div>
                    <div class="form-group"><label>Contato:</label><input type="text" id="contatoEdicao"></div>
                    <div class="form-group"><label>Cores:</label><input type="text" id="coresEdicao"></div>
                    
                    <!-- ALTERAÇÃO: Wrapper table-responsive -->
                    <div class="table-responsive">
                        <table id="tabelaProdutosEdicao">
                            <thead><tr><th>Qtd</th><th>Desc</th><th>Unit</th><th>Total</th><th>Ação</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                    <button type="button" id="btnAddProdutoEdicao">Add Produto</button>

                    <div class="form-group"><label>Frete:</label><input type="text" id="valorFreteEdicao"></div>
                    <div class="form-group"><label>Subtotal Pedido:</label><input type="text" id="valorPedidoEdicao"></div>
                    <div class="form-group"><label>Total Geral:</label><input type="text" id="totalEdicao"></div>
                    <div class="form-group"><label>Entrada:</label><input type="text" id="entradaEdicao"></div>
                    <div class="form-group"><label>Restante:</label><input type="text" id="restanteEdicao"></div>
                    <div class="form-group"><label>Obs:</label><textarea id="observacoesEdicao"></textarea></div>

                    <button type="button" id="btnSalvarPedidoEdicao">Salvar Pedido</button>
                </section>

                 <!-- PÁGINA: RELATÓRIO -->
                 <section id="relatorio" class="pagina" style="display: none;">
                    <h2>Relatórios</h2>
                    <p>Funcionalidade em desenvolvimento.</p>
                    <button onclick="gerarRelatorioXLSX()">Exportar Excel</button>
                 </section>
            </div>
        </div>
    </section>

    <!-- =========================================
         TELA 4: MÓDULO PRECIFICAÇÃO
    ========================================= -->
    <section id="module-precificacao" style="display: none;">
        <button class="btn-back-hub">⬅ Voltar ao Menu</button>

        <div id="app-container-precificacao" style="width: 90%; margin: 20px auto; background: #fff; padding: 20px;">
            <header>
                 <h1>Precificação</h1>
                 <nav>
                     <ul>
                        <li><a href="#" data-submenu="materiais-insumos" class="nav-link">Materiais</a></li>
                        <li><a href="#" data-submenu="mao-de-obra" class="nav-link">Mão de Obra</a></li>
                        <li><a href="#" data-submenu="cadastrar-produtos" class="nav-link">Produtos</a></li>
                        <li><a href="#" data-submenu="calculo-precificacao" class="nav-link">Calcular Preço</a></li>
                        <li><a href="#" data-submenu="historico-precificacao" class="nav-link">Histórico</a></li>
                    </ul>
                 </nav>
            </header>

            <!-- SUBPÁGINA: MATERIAIS -->
            <div id="materiais-insumos" class="subpagina">
                <h2>Cadastro de Materiais</h2>
                <form id="form-materiais-insumos">
                    <div class="form-group">
                        <label>Nome:</label><input type="text" id="nome-material">
                    </div>
                    <div class="form-group">
                        <label>Tipo:</label>
                        <label><input type="radio" name="tipo-material" value="unidade" checked> Unidade</label>
                        <label><input type="radio" name="tipo-material" value="comprimento"> Comprimento</label>
                    </div>
                    <div class="form-group">
                        <label>Custo Total Compra:</label><input type="number" id="valor-total-material" step="0.01">
                    </div>
                    <button type="button" id="cadastrar-material-insumo-btn">Salvar Material</button>
                </form>
                <input type="text" id="busca-material" placeholder="Filtrar..." onkeyup="buscarMateriaisCadastrados()">
                
                <!-- ALTERAÇÃO: Wrapper table-responsive -->
                <div class="table-responsive">
                    <table id="tabela-materiais-insumos">
                        <thead><tr><th>Nome</th><th>Tipo</th><th>Medida</th><th>Custo Tot.</th><th>Unitário</th><th>Ações</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- SUBPÁGINA: MÃO DE OBRA -->
            <div id="mao-de-obra" class="subpagina" style="display:none;">
                <h2>Configuração de Mão de Obra</h2>
                <div class="form-group">
                    <label>Salário Desejado:</label>
                    <input type="number" id="salario-receber">
                </div>
                <div class="form-group">
                    <label>Horas Mensais:</label>
                    <input type="number" id="horas-trabalhadas" value="220">
                </div>
                <div class="form-group">
                    <label>Incluir Férias/13º?</label>
                    <input type="checkbox" id="incluir-ferias-13o-sim"> Sim
                </div>
                <div class="form-group">
                    <label>Valor Hora Calculado:</label>
                    <input type="text" id="valor-hora" readonly>
                </div>
                <button id="btn-salvar-mao-de-obra">Salvar Configuração</button>
                <button id="btn-editar-mao-de-obra" style="display:none;">Editar</button>

                <hr>
                <h3>Custos Indiretos (Base)</h3>
                <!-- ALTERAÇÃO: Wrapper table-responsive -->
                <div class="table-responsive">
                    <table id="tabela-custos-indiretos">
                        <thead><tr><th>Descrição</th><th>Mensal</th><th>Por Hora</th><th>Ação</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- SUBPÁGINA: PRODUTOS -->
            <div id="cadastrar-produtos" class="subpagina" style="display:none;">
                <h2>Montagem de Produtos</h2>
                <form id="form-produtos-cadastrados">
                    <div class="form-group"><label>Nome do Produto:</label><input type="text" id="nome-produto"></div>
                    
                    <div style="position:relative;">
                        <input type="text" id="pesquisa-material" placeholder="Pesquisar material para adicionar...">
                        <div id="resultados-pesquisa" style="display:none; position:absolute; background:white; border:1px solid #ccc; width:100%; max-height:150px; overflow-y:auto; z-index:100;"></div>
                    </div>

                    <!-- ALTERAÇÃO: Wrapper table-responsive -->
                    <div class="table-responsive">
                        <table id="tabela-materiais-produto">
                            <thead><tr><th>Material</th><th>Tipo</th><th>Custo Base</th><th>Dim/Qtd</th><th>Qtd</th><th>Total</th><th>Ação</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>

                    <button type="button" id="cadastrar-produto-btn">Salvar Produto</button>
                </form>
                
                <!-- ALTERAÇÃO: Wrapper table-responsive -->
                <div class="table-responsive">
                    <table id="tabela-produtos">
                        <thead><tr><th>Produto</th><th>Itens</th><th>-</th><th>Custo Total</th><th>Ação</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- SUBPÁGINA: CÁLCULO -->
            <div id="calculo-precificacao" class="subpagina" style="display:none;">
                <h2>Calculadora de Preço</h2>
                <div class="form-group">
                    <label>Selecione Produto:</label>
                    <input type="text" id="produto-pesquisa" placeholder="Busque um produto...">
                    <div id="produto-resultados" class="hidden" style="display:none; position:absolute; background:white; border:1px solid #ccc; max-height:150px; overflow-y:auto; z-index:100;"></div>
                </div>
                
                <div class="info-box">
                    <p>Custo Materiais: <span id="custo-produto">R$ 0,00</span></p>
                    <p>Tempo de Produção (horas): <input type="number" id="horas-produto" value="1" style="width:60px;"></p>
                    <p>Custo Mão de Obra: <span id="custo-mao-de-obra-detalhe">R$ 0,00</span></p>
                    <p>Custos Indiretos: <span id="custo-indireto">R$ 0,00</span></p>
                    <hr>
                    <p><strong>Subtotal (Custo): <span id="subtotal">R$ 0,00</span></strong></p>
                </div>

                <div class="form-group">
                    <label>Margem de Lucro (%):</label>
                    <input type="number" id="margem-lucro-final" value="50">
                </div>
                
                <h3>Resultado</h3>
                <p>Lucro: <span id="margem-lucro-valor">R$ 0,00</span></p>
                <p>Preço Final Sugerido: <strong id="total-final" style="font-size:1.4em;">R$ 0,00</strong></p>
                <p style="display:none;">Com taxas: <span id="total-final-com-taxas"></span></p>

                <div class="form-group"><label>Cliente:</label><input type="text" id="nome-cliente"></div>
                <button id="btn-gerar-nota">Salvar Cálculo</button>
            </div>

            <!-- SUBPÁGINA: HISTÓRICO -->
            <div id="historico-precificacao" class="subpagina" style="display:none;">
                <h2>Histórico de Cálculos</h2>
                <!-- ALTERAÇÃO: Wrapper table-responsive -->
                <div class="table-responsive">
                    <table id="tabela-precificacoes-geradas">
                        <thead><tr><th>ID</th><th>Cliente</th><th>Ação</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>

    <!-- PWA Service Worker Registration -->
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('./sw.js')
            .then(reg => console.log('SW registrado com sucesso:', reg.scope))
            .catch(err => console.log('Falha ao registrar SW:', err));
        });
      }
    </script>
</body>
</html>