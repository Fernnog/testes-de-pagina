<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal P√©rola Rara</title>
    <link rel="icon" href="assets/images/favicon.ico" type="image/x-icon">
    
    <!-- CSS Unificados -->
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/orcamentos.css">
    <link rel="stylesheet" href="assets/css/precificacao.css">

    <!-- Bibliotecas Externas -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

    <!-- Scripts Modulares -->
    <script type="module" src="assets/js/main.js"></script>
    <script type="module" src="assets/js/orcamentos.js"></script>
    <script type="module" src="assets/js/precificacao.js"></script>
</head>
<body>

    <!-- =========================================
         TELA 1: LOGIN CENTRALIZADO
    ========================================= -->
    <section id="auth-screen">
        <div class="auth-container">
            <div class="auth-form">
                <div class="logo-container">
                    <img src="assets/images/logo_perola_rara.png" alt="Logo P√©rola Rara" id="logo-login" style="max-width: 150px; display:block; margin: 0 auto;">
                </div>
                <h2>Acesso ao Portal</h2>
                
                <div class="form-group">
                    <label for="email">Email:</label>
                    <input type="email" id="email" name="email" placeholder="Digite seu email">
                </div>
                <div class="form-group">
                    <label for="password">Senha:</label>
                    <input type="password" id="password" name="password" placeholder="Digite sua senha">
                </div>
                <div class="auth-buttons">
                    <button type="button" id="loginBtn">Entrar</button>
                </div>
                <p id="auth-message" class="auth-message"></p>
                <p class="slogan" style="text-align: center; margin-top: 20px;"><strong><em>"P√©rola Rara, onde a arte se encontra com o amor em cada detalhe".</em></strong></p>
            </div>
        </div>
    </section>

    <!-- =========================================
         TELA 2: HUB (MENU PRINCIPAL)
    ========================================= -->
    <section id="hub-screen" style="display: none;">
        <header class="hub-header">
            <img src="assets/images/logo_perola_rara.png" alt="Logo P√©rola Rara">
            <h1>Ol√°! Bem-vindo(a)</h1>
            <p>Logado como: <span id="user-email-display">...</span></p>
            <p>Selecione o m√≥dulo que deseja acessar:</p>
        </header>

        <div class="hub-cards-container">
            <!-- Cart√£o 1 -->
            <div class="hub-card" id="btn-go-orcamentos">
                <h2 style="font-size: 3rem;">üìù</h2>
                <h3>Or√ßamentos e Pedidos</h3>
                <p>Gerenciamento de clientes, cria√ß√£o de or√ßamentos e controle de produ√ß√£o.</p>
            </div>

            <!-- Cart√£o 2 -->
            <div class="hub-card" id="btn-go-precificacao">
                <h2 style="font-size: 3rem;">üßÆ</h2>
                <h3>Precifica√ß√£o</h3>
                <p>C√°lculo de custos de materiais, m√£o de obra e margem de lucro.</p>
            </div>
        </div>

        <button id="hubLogoutBtn">Sair do Sistema</button>
    </section>

    <!-- =========================================
         TELA 3: M√ìDULO OR√áAMENTOS
    ========================================= -->
    <section id="module-orcamentos" style="display: none;">
        <button class="btn-back-hub">‚¨Ö Voltar ao Menu</button>
        
        <div class="container">
            <header>
                 <h1>P√©rola Rara - Gest√£o de Pedidos</h1>
                 <nav>
                    <ul>
                        <li><a href="#" data-pagina="form-orcamento">Novo Or√ßamento</a></li>
                        <li><a href="#" data-pagina="orcamentos-gerados">Or√ßamentos Gerados</a></li>
                        <li><a href="#" data-pagina="lista-pedidos">Pedidos Realizados</a></li>
                        <li><a href="#" data-pagina="relatorio">Relat√≥rio</a></li>
                    </ul>
                 </nav>
            </header>
            
            <div id="appContent">
                <!-- P√ÅGINA 1: FORMUL√ÅRIO DE OR√áAMENTO -->
                <section id="form-orcamento" class="pagina">
                    <h2>Novo Or√ßamento</h2>
                    <form id="orcamento">
                        <div class="form-row">
                            <div class="form-group"><label>Data:</label><input type="date" id="dataOrcamento"></div>
                            <div class="form-group"><label>Validade:</label><input type="date" id="dataValidade"></div>
                        </div>
                        <div class="form-group"><label>Cliente:</label><input type="text" id="cliente"></div>
                        <div class="form-group"><label>Endere√ßo:</label><input type="text" id="endereco"></div>
                        <div class="form-row">
                            <div class="form-group"><label>Cidade:</label><input type="text" id="cidade"></div>
                            <div class="form-group"><label>Telefone:</label><input type="text" id="telefone"></div>
                        </div>
                        <div class="form-group"><label>Email:</label><input type="email" id="clienteEmail"></div>
                        <div class="form-row">
                            <div class="form-group"><label>Tema:</label><input type="text" id="tema"></div>
                            <div class="form-group"><label>Cores:</label><input type="text" id="cores"></div>
                        </div>

                        <h3>Produtos</h3>
                        <table id="tabelaProdutos">
                            <thead>
                                <tr>
                                    <th>Qtd</th>
                                    <th>Descri√ß√£o</th>
                                    <th>Valor Unit.</th>
                                    <th>Total</th>
                                    <th>A√ß√£o</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                        <button type="button" id="btnAddProdutoOrcamento">Adicionar Produto</button>

                        <div class="form-row valores-pedido" style="margin-top: 20px;">
                            <div class="form-group"><label>Frete:</label><input type="text" id="valorFrete" placeholder="R$ 0,00"></div>
                            <div class="form-group"><label>Subtotal:</label><input type="text" id="valorOrcamento" readonly></div>
                            <div class="form-group"><label>Total Final:</label><input type="text" id="total" readonly></div>
                        </div>
                        
                        <div class="form-group">
                            <label>Formas de Pagamento:</label>
                            <label><input type="checkbox" name="pagamento" value="Pix"> Pix</label>
                            <label><input type="checkbox" name="pagamento" value="Cart√£o"> Cart√£o</label>
                        </div>
                        <div class="form-group"><label>Observa√ß√µes:</label><textarea id="observacoes"></textarea></div>

                        <button type="button" id="btnGerarOrcamento">Gerar Or√ßamento</button>
                        <button type="button" id="btnAtualizarOrcamento" style="display:none;">Salvar Altera√ß√µes</button>
                    </form>
                </section>

                <!-- P√ÅGINA 2: OR√áAMENTOS GERADOS -->
                <section id="orcamentos-gerados" class="pagina" style="display: none;">
                    <h2>Or√ßamentos Gerados</h2>
                    <button onclick="filtrarOrcamentos()">Atualizar Lista</button>
                    <table id="tabela-orcamentos">
                        <thead>
                            <tr><th>N¬∫</th><th>Data</th><th>Cliente</th><th>Total</th><th>Pedido?</th><th>A√ß√µes</th></tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </section>

                <!-- P√ÅGINA 3: PEDIDOS -->
                <section id="lista-pedidos" class="pagina" style="display: none;">
                    <h2>Pedidos Realizados</h2>
                    <button onclick="filtrarPedidos()">Atualizar Lista</button>
                    <table id="tabela-pedidos">
                        <thead>
                            <tr><th>N¬∫</th><th>Data</th><th>Cliente</th><th>Total</th><th>A√ß√µes</th></tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </section>
                
                <!-- P√ÅGINA: EDI√á√ÉO DE PEDIDO -->
                <section id="form-edicao-pedido" class="pagina" style="display: none;">
                    <h2>Editar Pedido</h2>
                    <input type="hidden" id="dataPedidoEdicao">
                    <div class="form-group"><label>Cliente:</label><input type="text" id="clienteEdicao"></div>
                    <div class="form-group"><label>Entrega:</label><input type="date" id="dataEntregaEdicao"></div>
                    <div class="form-group"><label>Endere√ßo:</label><input type="text" id="enderecoEdicao"></div>
                    <div class="form-group"><label>Tema:</label><input type="text" id="temaEdicao"></div>
                    <div class="form-group"><label>Cidade:</label><input type="text" id="cidadeEdicao"></div>
                    <div class="form-group"><label>Contato:</label><input type="text" id="contatoEdicao"></div>
                    <div class="form-group"><label>Cores:</label><input type="text" id="coresEdicao"></div>
                    
                    <table id="tabelaProdutosEdicao">
                        <thead><tr><th>Qtd</th><th>Desc</th><th>Unit</th><th>Total</th><th>A√ß√£o</th></tr></thead>
                        <tbody></tbody>
                    </table>
                    <button type="button" id="btnAddProdutoEdicao">Add Produto</button>

                    <div class="form-group"><label>Frete:</label><input type="text" id="valorFreteEdicao"></div>
                    <div class="form-group"><label>Subtotal Pedido:</label><input type="text" id="valorPedidoEdicao"></div>
                    <div class="form-group"><label>Total Geral:</label><input type="text" id="totalEdicao"></div>
                    <div class="form-group"><label>Entrada:</label><input type="text" id="entradaEdicao"></div>
                    <div class="form-group"><label>Restante:</label><input type="text" id="restanteEdicao"></div>
                    <div class="form-group"><label>Obs:</label><textarea id="observacoesEdicao"></textarea></div>

                    <button type="button" id="btnSalvarPedidoEdicao">Salvar Pedido</button>
                </section>

                 <!-- P√ÅGINA: RELAT√ìRIO (Placeholder) -->
                 <section id="relatorio" class="pagina" style="display: none;">
                    <h2>Relat√≥rios</h2>
                    <p>Funcionalidade em desenvolvimento.</p>
                    <button onclick="gerarRelatorioXLSX()">Exportar Excel</button>
                 </section>
            </div>
        </div>
    </section>

    <!-- =========================================
         TELA 4: M√ìDULO PRECIFICA√á√ÉO
    ========================================= -->
    <section id="module-precificacao" style="display: none;">
        <button class="btn-back-hub">‚¨Ö Voltar ao Menu</button>

        <div id="app-container-precificacao" style="width: 90%; margin: 20px auto; background: #fff; padding: 20px;">
            <header>
                 <h1>Precifica√ß√£o</h1>
                 <nav>
                     <ul>
                        <li><a href="#" data-submenu="materiais-insumos" class="nav-link">Materiais</a></li>
                        <li><a href="#" data-submenu="mao-de-obra" class="nav-link">M√£o de Obra</a></li>
                        <li><a href="#" data-submenu="cadastrar-produtos" class="nav-link">Produtos</a></li>
                        <li><a href="#" data-submenu="calculo-precificacao" class="nav-link">Calcular Pre√ßo</a></li>
                        <li><a href="#" data-submenu="historico-precificacao" class="nav-link">Hist√≥rico</a></li>
                    </ul>
                 </nav>
            </header>

            <!-- SUBP√ÅGINA: MATERIAIS -->
            <div id="materiais-insumos" class="subpagina">
                <h2>Cadastro de Materiais</h2>
                <form id="form-materiais-insumos">
                    <div class="form-group">
                        <label>Nome:</label><input type="text" id="nome-material">
                    </div>
                    <div class="form-group">
                        <label>Tipo:</label>
                        <label><input type="radio" name="tipo-material" value="unidade" checked> Unidade</label>
                        <label><input type="radio" name="tipo-material" value="comprimento"> Comprimento</label>
                        <!-- Adicione mais tipos se o JS suportar -->
                    </div>
                    <div class="form-group">
                        <label>Custo Total Compra:</label><input type="number" id="valor-total-material" step="0.01">
                    </div>
                    <!-- Campos adicionais de dimens√£o podem ser inseridos aqui se o JS exigir, ex: div id="campos-comprimento" -->
                    <button type="button" id="cadastrar-material-insumo-btn">Salvar Material</button>
                </form>
                <input type="text" id="busca-material" placeholder="Filtrar..." onkeyup="buscarMateriaisCadastrados()">
                <table id="tabela-materiais-insumos">
                    <thead><tr><th>Nome</th><th>Tipo</th><th>Medida</th><th>Custo Tot.</th><th>Unit√°rio</th><th>A√ß√µes</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>

            <!-- SUBP√ÅGINA: M√ÉO DE OBRA -->
            <div id="mao-de-obra" class="subpagina" style="display:none;">
                <h2>Configura√ß√£o de M√£o de Obra</h2>
                <div class="form-group">
                    <label>Sal√°rio Desejado:</label>
                    <input type="number" id="salario-receber">
                </div>
                <div class="form-group">
                    <label>Horas Mensais:</label>
                    <input type="number" id="horas-trabalhadas" value="220">
                </div>
                <div class="form-group">
                    <label>Incluir F√©rias/13¬∫?</label>
                    <input type="checkbox" id="incluir-ferias-13o-sim"> Sim
                </div>
                <div class="form-group">
                    <label>Valor Hora Calculado:</label>
                    <input type="text" id="valor-hora" readonly>
                </div>
                <button id="btn-salvar-mao-de-obra">Salvar Configura√ß√£o</button>
                <button id="btn-editar-mao-de-obra" style="display:none;">Editar</button>

                <hr>
                <h3>Custos Indiretos (Base)</h3>
                <table id="tabela-custos-indiretos">
                    <thead><tr><th>Descri√ß√£o</th><th>Mensal</th><th>Por Hora</th><th>A√ß√£o</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>

            <!-- SUBP√ÅGINA: PRODUTOS -->
            <div id="cadastrar-produtos" class="subpagina" style="display:none;">
                <h2>Montagem de Produtos</h2>
                <form id="form-produtos-cadastrados">
                    <div class="form-group"><label>Nome do Produto:</label><input type="text" id="nome-produto"></div>
                    
                    <!-- √Årea de Pesquisa de Material -->
                    <div style="position:relative;">
                        <input type="text" id="pesquisa-material" placeholder="Pesquisar material para adicionar...">
                        <div id="resultados-pesquisa" style="display:none; position:absolute; background:white; border:1px solid #ccc; width:100%; max-height:150px; overflow-y:auto; z-index:100;"></div>
                    </div>

                    <table id="tabela-materiais-produto">
                        <thead><tr><th>Material</th><th>Tipo</th><th>Custo Base</th><th>Dim/Qtd</th><th>Qtd</th><th>Total</th><th>A√ß√£o</th></tr></thead>
                        <tbody></tbody>
                    </table>

                    <button type="button" id="cadastrar-produto-btn">Salvar Produto</button>
                </form>
                <table id="tabela-produtos">
                    <thead><tr><th>Produto</th><th>Itens</th><th>-</th><th>Custo Total</th><th>A√ß√£o</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>

            <!-- SUBP√ÅGINA: C√ÅLCULO -->
            <div id="calculo-precificacao" class="subpagina" style="display:none;">
                <h2>Calculadora de Pre√ßo</h2>
                <div class="form-group">
                    <label>Selecione Produto:</label>
                    <input type="text" id="produto-pesquisa" placeholder="Busque um produto...">
                    <div id="produto-resultados" class="hidden" style="display:none; position:absolute; background:white; border:1px solid #ccc; max-height:150px; overflow-y:auto; z-index:100;"></div>
                </div>
                
                <div class="info-box">
                    <p>Custo Materiais: <span id="custo-produto">R$ 0,00</span></p>
                    <p>Tempo de Produ√ß√£o (horas): <input type="number" id="horas-produto" value="1" style="width:60px;"></p>
                    <p>Custo M√£o de Obra: <span id="custo-mao-de-obra-detalhe">R$ 0,00</span></p>
                    <p>Custos Indiretos: <span id="custo-indireto">R$ 0,00</span></p>
                    <hr>
                    <p><strong>Subtotal (Custo): <span id="subtotal">R$ 0,00</span></strong></p>
                </div>

                <div class="form-group">
                    <label>Margem de Lucro (%):</label>
                    <input type="number" id="margem-lucro-final" value="50">
                </div>
                
                <h3>Resultado</h3>
                <p>Lucro: <span id="margem-lucro-valor">R$ 0,00</span></p>
                <p>Pre√ßo Final Sugerido: <strong id="total-final" style="font-size:1.4em;">R$ 0,00</strong></p>
                <p style="display:none;">Com taxas: <span id="total-final-com-taxas"></span></p>

                <div class="form-group"><label>Cliente:</label><input type="text" id="nome-cliente"></div>
                <button id="btn-gerar-nota">Salvar C√°lculo</button>
            </div>

            <!-- SUBP√ÅGINA: HIST√ìRICO -->
            <div id="historico-precificacao" class="subpagina" style="display:none;">
                <h2>Hist√≥rico de C√°lculos</h2>
                <table id="tabela-precificacoes-geradas">
                    <thead><tr><th>ID</th><th>Cliente</th><th>A√ß√£o</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </section>

</body>
</html>
