<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal P√©rola Rara</title>
    
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#ecd5d1">
    
    <!-- Fontes -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

    <link rel="icon" href="assets/images/favicon.ico" type="image/x-icon">
    
    <!-- Estilos -->
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/orcamentos.css">
    <link rel="stylesheet" href="assets/css/precificacao.css">

    <!-- Bibliotecas Externas -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

    <!-- M√≥dulos JS -->
    <script type="module" src="assets/js/firebase-config.js"></script> <!-- Garantir ordem -->
    <script type="module" src="assets/js/precificacao-insumos.js"></script> <!-- NOVO ARQUIVO -->
    <script type="module" src="assets/js/main.js"></script>
    <script type="module" src="assets/js/orcamentos.js"></script>
    <script type="module" src="assets/js/precificacao.js"></script>
</head>
<body>

    <!-- 1. TELA DE LOGIN -->
    <section id="auth-screen">
        <div class="auth-container">
            <div class="auth-form">
                <div class="logo-container">
                    <img src="assets/images/logo_perola_rara.png" alt="Logo P√©rola Rara" id="logo-login" width="150">
                    <h1 class="login-brand-name">P√©rola Rara</h1>
                </div>
                <h2>Acesso ao Portal</h2>
                
                <div class="form-group">
                    <label for="email">Email:</label>
                    <input type="email" id="email" name="email" placeholder="Digite seu email">
                </div>
                <div class="form-group">
                    <label for="password">Senha:</label>
                    <input type="password" id="password" name="password" placeholder="Digite sua senha">
                </div>
                <div class="auth-buttons">
                    <button type="button" id="loginBtn">Entrar</button>
                </div>
                <p id="auth-message" class="auth-message"></p>
            </div>
        </div>
    </section>

    <!-- 2. SPLASH SCREEN (Carregamento) -->
    <section id="splash-screen" style="display: none;">
        <div class="splash-content">
            <img src="assets/images/logo_perola_rara.png" alt="Logo" class="splash-logo" width="150">
            <p class="splash-slogan">"Onde a arte se encontra com o amor em cada detalhe."</p>
        </div>
    </section>

    <!-- 3. HUB CENTRAL (Menu Principal) -->
    <section id="hub-screen" style="display: none;">
        <header class="hub-header">
            <img src="assets/images/logo_perola_rara.png" alt="Logo" width="120">
            <div class="welcome-text">
                <h1>Painel Administrativo</h1>
                <div class="user-info-card">
                    <span class="user-icon">üë§</span>
                    <span id="user-email-display">...</span>
                </div>
            </div>
        </header>

        <div class="hub-cards-container">
            <!-- Card Or√ßamentos -->
            <div class="hub-card" id="btn-go-orcamentos">
                <div class="card-icon">üìã</div>
                <h3>Gest√£o de Pedidos</h3>
                <p>Gerencie clientes, or√ßamentos e fila de produ√ß√£o.</p>
                <div class="card-footer"><span class="card-action">Acessar &rarr;</span></div>
            </div>

            <!-- Card Precifica√ß√£o -->
            <div class="hub-card" id="btn-go-precificacao">
                <div class="card-icon">üí∞</div>
                <h3>Precifica√ß√£o</h3>
                <p>Calcule custos de materiais e defina pre√ßos de venda.</p>
                <div class="card-footer"><span class="card-action">Acessar &rarr;</span></div>
            </div>
        </div>

        <div class="hub-footer-actions">
            <button id="hubLogoutBtn" class="btn-logout-solid">Desconectar</button>
        </div>
        <div id="version-container"></div>
    </section>

    <!-- 4. M√ìDULO: OR√áAMENTOS (COMPLETO) -->
    <section id="module-orcamentos" style="display: none;">
        <button class="btn-back-hub">‚¨Ö Voltar ao Menu</button>
        
        <div class="container mobile-container">
            <header class="module-header-styled">
                 <h1 class="module-title-main">Gest√£o de Pedidos</h1>
                 
                 <nav class="nav-lined">
                    <ul>
                        <li><a href="#" data-pagina="form-orcamento">Novo Or√ßamento</a></li>
                        <li><a href="#" data-pagina="orcamentos-gerados">Or√ßamentos Gerados</a></li>
                        <li><a href="#" data-pagina="lista-pedidos">Pedidos Realizados</a></li>
                        <li><a href="#" data-pagina="relatorio">Relat√≥rio</a></li>
                    </ul>
                 </nav>
            </header>
            
            <div id="appContent">
                <!-- FORMUL√ÅRIO DE NOVO OR√áAMENTO -->
                <section id="form-orcamento" class="pagina">
                    <h2 class="section-title-lined">Novo Or√ßamento</h2>
                    <form id="orcamento">
                        <div class="form-row">
                            <div class="form-group"><label>Data:</label><input type="date" id="dataOrcamento"></div>
                            <div class="form-group"><label>Validade:</label><input type="date" id="dataValidade"></div>
                        </div>
                        <div class="form-group"><label>Cliente:</label><input type="text" id="cliente" placeholder="Nome do Cliente"></div>
                        <div class="form-group"><label>Endere√ßo:</label><input type="text" id="endereco"></div>
                        <div class="form-row">
                            <div class="form-group"><label>Cidade:</label><input type="text" id="cidade"></div>
                            <div class="form-group"><label>Telefone:</label><input type="text" id="telefone"></div>
                        </div>
                        <div class="form-group"><label>Email:</label><input type="email" id="clienteEmail"></div>
                        <div class="form-row">
                            <div class="form-group"><label>Tema:</label><input type="text" id="tema"></div>
                            <div class="form-group"><label>Cores:</label><input type="text" id="cores"></div>
                        </div>

                        <h3>Produtos</h3>
                        <div class="table-responsive">
                            <table id="tabelaProdutos">
                                <thead>
                                    <tr>
                                        <th>Qtd</th>
                                        <th>Descri√ß√£o</th>
                                        <th>Valor Unit.</th>
                                        <th>Total</th>
                                        <th>A√ß√£o</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                        <button type="button" id="btnAddProdutoOrcamento">Adicionar Produto</button>

                        <div class="form-row valores-pedido" style="margin-top: 20px;">
                            <div class="form-group"><label>Frete:</label><input type="text" id="valorFrete" placeholder="R$ 0,00"></div>
                            <div class="form-group"><label>Subtotal:</label><input type="text" id="valorOrcamento" readonly></div>
                            <div class="form-group"><label>Total Final:</label><input type="text" id="total" readonly></div>
                        </div>
                        
                        <div class="form-group">
                            <label>Formas de Pagamento:</label>
                            <label><input type="checkbox" name="pagamento" value="Pix"> Pix</label>
                            <label><input type="checkbox" name="pagamento" value="Cart√£o"> Cart√£o</label>
                        </div>
                        <div class="form-group"><label>Observa√ß√µes:</label><textarea id="observacoes"></textarea></div>

                        <button type="button" id="btnGerarOrcamento">Gerar Or√ßamento</button>
                        <button type="button" id="btnAtualizarOrcamento" style="display:none;">Salvar Altera√ß√µes</button>
                    </form>
                </section>

                <!-- LISTA DE OR√áAMENTOS GERADOS -->
                <section id="orcamentos-gerados" class="pagina" style="display: none;">
                    <h2 class="section-title-lined">Or√ßamentos Gerados</h2>
                    <button onclick="filtrarOrcamentos()">Atualizar Lista</button>
                    <div class="table-responsive">
                        <table id="tabela-orcamentos">
                            <thead><tr><th>N¬∫</th><th>Data</th><th>Cliente</th><th>Total</th><th>Pedido?</th><th>A√ß√µes</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </section>

                <!-- LISTA DE PEDIDOS REALIZADOS -->
                <section id="lista-pedidos" class="pagina" style="display: none;">
                    <h2 class="section-title-lined">Pedidos Realizados</h2>
                    <button onclick="filtrarPedidos()">Atualizar Lista</button>
                    <div class="table-responsive">
                        <table id="tabela-pedidos">
                            <thead><tr><th>N¬∫</th><th>Data</th><th>Cliente</th><th>Total</th><th>A√ß√µes</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </section>
                
                <!-- FORMUL√ÅRIO DE EDI√á√ÉO DE PEDIDO -->
                <section id="form-edicao-pedido" class="pagina" style="display: none;">
                    <h2 class="section-title-lined">Editar Pedido</h2>
                    <input type="hidden" id="dataPedidoEdicao">
                    
                    <!-- Dados B√°sicos -->
                    <div class="form-row">
                        <div class="form-group"><label>Cliente:</label><input type="text" id="clienteEdicao"></div>
                        <div class="form-group"><label>Entrega:</label><input type="date" id="dataEntregaEdicao"></div>
                    </div>
                    <div class="form-group"><label>Endere√ßo:</label><input type="text" id="enderecoEdicao"></div>
                    <div class="form-row">
                        <div class="form-group"><label>Cidade:</label><input type="text" id="cidadeEdicao"></div>
                        <div class="form-group"><label>Telefone:</label><input type="text" id="contatoEdicao"></div>
                    </div>
                    <div class="form-row">
                         <div class="form-group"><label>Tema:</label><input type="text" id="temaEdicao"></div>
                         <div class="form-group"><label>Cores:</label><input type="text" id="coresEdicao"></div>
                    </div>

                    <!-- Tabela de Produtos -->
                    <h3>Produtos</h3>
                    <div class="table-responsive">
                        <table id="tabelaProdutosEdicao">
                            <thead><tr><th>Qtd</th><th>Desc</th><th>Unit</th><th>Total</th><th>A√ß√£o</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                    <button type="button" id="btnAddProdutoEdicao">Add Produto</button>

                    <!-- Campos Financeiros -->
                    <div class="form-row valores-pedido" style="margin-top: 20px;">
                        <div class="form-group">
                            <label>Frete (R$):</label>
                            <input type="text" id="valorFreteEdicao" placeholder="R$ 0,00" oninput="formatarEntradaMoeda(this)" onblur="atualizarTotaisEdicao()">
                        </div>
                        <div class="form-group">
                            <label>Subtotal Produtos (R$):</label>
                            <input type="text" id="valorPedidoEdicao" placeholder="R$ 0,00" oninput="formatarEntradaMoeda(this)" onblur="atualizarTotaisEdicao()">
                        </div>
                    </div>

                    <div class="form-row valores-pedido">
                        <div class="form-group">
                            <label style="color: #7aa2a9; font-weight: bold;">Custo M√£o de Obra (R$):</label>
                            <input type="text" id="custoMaoDeObraEdicao" placeholder="R$ 0,00" oninput="formatarEntradaMoeda(this)">
                        </div>
                        <div class="form-group">
                            <label style="color: #7aa2a9; font-weight: bold;">Margem de Lucro (R$):</label>
                            <input type="text" id="margemLucroEdicao" placeholder="R$ 0,00" oninput="formatarEntradaMoeda(this)">
                        </div>
                    </div>

                    <div class="form-row valores-pedido">
                        <div class="form-group">
                            <label>Total Geral (R$):</label>
                            <input type="text" id="totalEdicao" readonly>
                        </div>
                        <div class="form-group">
                            <label>Entrada (R$):</label>
                            <input type="text" id="entradaEdicao" placeholder="R$ 0,00" oninput="formatarEntradaMoeda(this)" onblur="atualizarRestanteEdicao()">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Restante (R$):</label>
                        <input type="text" id="restanteEdicao" readonly>
                    </div>

                    <div class="form-group"><label>Observa√ß√µes:</label><textarea id="observacoesEdicao"></textarea></div>

                    <button type="button" id="btnSalvarPedidoEdicao">Salvar Pedido</button>
                </section>

                 <section id="relatorio" class="pagina" style="display: none;">
                    <h2 class="section-title-lined">Relat√≥rios</h2>
                    <p>Funcionalidade em desenvolvimento.</p>
                    <button onclick="gerarRelatorioXLSX()">Exportar Excel</button>
                 </section>
            </div>
        </div>
    </section>

    <!-- 5. M√ìDULO: PRECIFICA√á√ÉO (MODIFICADO) -->
    <section id="module-precificacao" style="display: none;">
        <button class="btn-back-hub">‚¨Ö Voltar ao Menu</button>

        <div id="app-container-precificacao" class="mobile-container">
            <header class="module-header-styled">
                 <img src="assets/images/logo_perola_rara.png" class="module-logo-small" alt="Logo">
                 <h1 class="module-title-main">P√©rola Rara</h1>
                 
                 <nav class="nav-lined">
                     <ul>
                        <li><a href="#" data-submenu="materiais-insumos" class="nav-link">Materiais</a></li>
                        <li><a href="#" data-submenu="mao-de-obra" class="nav-link">M√£o de Obra</a></li>
                        <li><a href="#" data-submenu="custos-indiretos" class="nav-link">Custos Indiretos</a></li>
                        <li><a href="#" data-submenu="cadastrar-produtos" class="nav-link">Produtos</a></li>
                        <!-- ATUALIZADO: Menu renomeado de "Calculadora" para "Precifica√ß√£o" -->
                        <li><a href="#" data-submenu="calculo-precificacao" class="nav-link">Precifica√ß√£o</a></li>
                        <li><a href="#" data-submenu="precificacoes-geradas" class="nav-link">Hist√≥rico</a></li>
                    </ul>
                 </nav>
            </header>

            <!-- ABA: MATERIAIS -->
            <div id="materiais-insumos" class="subpagina">
                <h2 class="section-title-lined">Cadastro de Materiais e Insumos</h2>
                <hr class="aviso-separador">
                <p class="aviso-unidades" style="text-align: center; font-size: 0.9em; color: #555;">
                    <strong>Aten√ß√£o:</strong> Preencha dimens√µes em <span>cm</span> (√Årea/Comprimento). Para Litro/Quilo/Unidade, use as unidades padr√£o (L, kg, un).
                </p>
                <hr class="aviso-separador">
                
                <form id="form-materiais-insumos">
                    <div class="form-group">
                        <label>Nome do Material:</label>
                        <input type="text" id="nome-material">
                    </div>
                    <div class="form-group">
                        <label>Tipo de Material:</label><br>
                        <label><input type="radio" name="tipo-material" value="comprimento" checked> Metro (Comprimento)</label>
                        <label><input type="radio" name="tipo-material" value="litro"> Litro</label>
                        <label><input type="radio" name="tipo-material" value="quilo"> Quilo</label>
                        <label><input type="radio" name="tipo-material" value="unidade"> Unidade</label>
                        <label><input type="radio" name="tipo-material" value="area"> √Årea (m¬≤)</label>
                    </div>
                    
                    <!-- Campos Din√¢micos -->
                    <div class="form-group" id="campos-comprimento">
                        <label>Comprimento (cm):</label>
                        <input type="number" id="comprimento-cm" step="0.01" value="100">
                    </div>
                    <div class="form-group" id="campos-litro" style="display: none;">
                        <label>Volume (ml):</label>
                        <input type="number" id="volume-ml" step="0.01" value="1000">
                    </div>
                    <div class="form-group" id="campos-quilo" style="display: none;">
                        <label>Peso (g):</label>
                        <input type="number" id="peso-g" step="0.01" value="1000">
                    </div>
                    <div class="form-group" id="campos-area" style="display: none;">
                        <label>Dimens√µes (cm):</label>
                        <div class="area-inputs" style="display:flex; align-items:center; gap:5px;">
                          <input type="number" id="largura-cm" step="0.01" value="100" placeholder="Largura">
                          <span>x</span>
                          <input type="number" id="altura-cm" step="0.01" value="100" placeholder="Altura">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Valor Total Compra (R$):</label>
                        <input type="number" id="valor-total-material" step="0.01">
                    </div>
                    <button type="button" id="cadastrar-material-insumo-btn">Cadastrar Material</button>
                </form>
                
                <div class="form-group">
                    <input type="text" id="busca-material" placeholder="Filtrar cadastrados..." onkeyup="buscarMateriaisCadastrados()">
                </div>
                
                <div class="table-responsive">
                    <table id="tabela-materiais-insumos" class="tabela-gerada">
                        <thead><tr><th>Nome</th><th>Tipo</th><th>Medida</th><th>Custo Loja</th><th>Custo Unit.</th><th>A√ß√µes</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- ABA: M√ÉO DE OBRA -->
            <div id="mao-de-obra" class="subpagina" style="display:none;">
                <h2 class="section-title-lined">Custo de M√£o de Obra</h2>
                <form id="form-mao-de-obra">
                    <div class="form-group">
                        <label>Sal√°rio a receber (R$):</label>
                        <input type="number" id="salario-receber" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>Horas trabalhadas por m√™s:</label>
                        <input type="number" id="horas-trabalhadas" value="220">
                    </div>
                    <div class="form-group">
                        <label>Valor da hora (Calculado):</label>
                        <input type="number" id="valor-hora" readonly style="background-color: #cae6e7; font-weight: bold;">
                    </div>
                    
                    <button type="button" id="btn-salvar-mao-de-obra">Salvar Configura√ß√£o</button>
                    <button type="button" id="btn-editar-mao-de-obra" style="display:none;">Editar</button>

                    <hr class="linha-separadora">
                    
                    <h3>Encargos (F√©rias e 13¬∫)</h3>
                    <div class="form-group">
                        <label>Incluir encargos?</label>
                        <label><input type="radio" id="incluir-ferias-13o-sim" name="incluir-ferias-13o"> Sim</label>
                        <label><input type="radio" id="incluir-ferias-13o-nao" name="incluir-ferias-13o" checked> N√£o</label>
                    </div>
                    <div class="form-group">
                        <label>Custo Adicional por Hora (R$):</label>
                        <input type="number" id="custo-ferias-13o" readonly style="background-color: #cae6e7;">
                    </div>
                </form>
            </div>

            <!-- ABA: CUSTOS INDIRETOS -->
            <div id="custos-indiretos" class="subpagina" style="display:none;">
                <h2 class="section-title-lined">Custos Indiretos</h2>
                <ul id="lista-custos-indiretos">
                    <!-- Preenchido via JS -->
                </ul>
                <button type="button" id="adicionarCustoIndiretoBtn">+ Custo Adicional</button>
                
                <div class="form-group" style="margin-top:20px;">
                    <input type="text" id="busca-custo-indireto" placeholder="Buscar custo..." onkeyup="buscarCustosIndiretosCadastrados()">
                </div>
                <div class="table-responsive">
                    <table id="tabela-custos-indiretos" class="tabela-gerada">
                        <thead><tr><th>Descri√ß√£o</th><th>Mensal</th><th>Por Hora</th><th>A√ß√£o</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- ABA: PRODUTOS -->
            <div id="cadastrar-produtos" class="subpagina" style="display:none;">
                <h2 class="section-title-lined">Montagem de Produtos</h2>
                <form id="form-produtos-cadastrados">
                    <div class="form-group">
                        <label>Nome do Produto:</label>
                        <input type="text" id="nome-produto">
                    </div>
                    
                    <div class="form-group" style="position:relative;">
                        <label>Adicionar Material:</label>
                        <input type="text" id="pesquisa-material" placeholder="Digite para pesquisar...">
                        <div id="resultados-pesquisa" style="display:none; position:absolute; background:white; border:1px solid #ccc; width:100%; max-height:150px; overflow-y:auto; z-index:100;"></div>
                    </div>
                    
                    <div class="table-responsive">
                        <table id="tabela-materiais-produto" class="tabela-gerada">
                            <thead><tr><th>Material</th><th>Tipo</th><th>Custo Unit.</th><th>Dimens√µes</th><th>Qtd</th><th>Total</th><th>A√ß√£o</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                    <button type="button" id="cadastrar-produto-btn">Cadastrar Produto</button>
                </form>

                <h2>Produtos Cadastrados</h2>
                <input type="text" id="busca-produto" placeholder="Buscar produto..." onkeyup="buscarProdutosCadastrados()">
                <div class="table-responsive">
                    <table id="tabela-produtos" class="tabela-gerada">
                        <thead><tr><th>Nome</th><th>Itens</th><th>-</th><th>Custo Total</th><th>A√ß√£o</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <!-- ABA: C√ÅLCULO (PRECIFICA√á√ÉO) - MODIFICADA (DASHBOARD) -->
            <div id="calculo-precificacao" class="subpagina" style="display:none;">
                <h2 class="section-title-lined">Precifica√ß√£o Inteligente</h2>

                <div class="pricing-dashboard">
                    <!-- COLUNA 1: ENTRADA DE DADOS (Pain√©is verticais) -->
                    <div class="pricing-inputs-area">
                        
                        <!-- Painel A: Defini√ß√£o do Produto -->
                        <div class="input-card">
                            <h3>1. Produto & Tempo</h3>
                            <div class="form-group" style="position: relative;">
                                <label>Selecione o Produto:</label>
                                <div class="input-wrapper">
                                    <input type="text" id="produto-pesquisa" placeholder="Busque o produto montado..." autocomplete="off">
                                    <div id="search-spinner" class="spinner hidden"></div>
                                    <span id="aviso-preco-existente" class="badge-aviso hidden"></span>
                                </div>
                                <div id="produto-resultados" class="hidden"></div>
                            </div>

                            <div class="form-row-compact">
                                <div class="form-group half">
                                    <label>Horas Gastas:</label>
                                    <input type="number" id="horas-produto" value="1" min="0.1" step="0.1">
                                </div>
                                <div class="form-group half info-box">
                                    <label>Custo Materiais:</label>
                                    <span id="custo-produto-display">R$ 0,00</span>
                                    <!-- Campo oculto para c√°lculo -->
                                    <span id="custo-produto" style="display:none;">0</span> 
                                </div>
                            </div>
                            
                            <!-- Detalhes colaps√°veis (Opcional, para n√£o poluir) -->
                            <details>
                                <summary>Ver Materiais Inclusos</summary>
                                <ul id="lista-materiais-produto" class="small-list"></ul>
                            </details>
                        </div>

                        <!-- Painel B: Defini√ß√£o Financeira -->
                        <div class="input-card">
                            <h3>2. Margem & Taxas</h3>
                            
                            <div class="form-group">
                                <label>Margem de Lucro (%):</label>
                                <div class="input-with-suffix">
                                    <input type="number" id="margem-lucro-final" value="50">
                                    <span>%</span>
                                </div>
                                <p class="help-text">Lucro destinado ao crescimento da empresa.</p>
                            </div>

                            <div class="form-group tax-group">
                                <label>Taxa de Cart√£o / Maquininha:</label>
                                <div class="tax-controls">
                                    <label class="switch-label">
                                        <input type="radio" id="incluir-taxa-credito-nao" name="taxa" checked> 
                                        Dinheiro/Pix
                                    </label>
                                    <label class="switch-label">
                                        <input type="radio" id="incluir-taxa-credito-sim" name="taxa"> 
                                        Cart√£o
                                    </label>
                                    <div class="tax-input-wrapper">
                                        <input type="number" id="taxa-credito-percentual" value="6">
                                        <span>%</span>
                                        <button type="button" id="btn-salvar-taxa-credito">Ok</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="action-area">
                            <button type="button" id="btn-gerar-nota" class="btn-primary-large">üíæ Salvar Precifica√ß√£o</button>
                        </div>
                    </div>

                    <!-- COLUNA 2: CART√ÉO DE RESULTADO (O Dashboard) -->
                    <div class="pricing-results-area">
                        <div class="result-card">
                            <div class="result-header">
                                <h4>Pre√ßo de Venda Sugerido</h4>
                                <div class="big-price" id="total-final-com-taxas">R$ 0,00</div>
                            </div>

                            <div class="result-body">
                                <!-- Bloco de Custos (O que sai) -->
                                <div class="result-section costs">
                                    <h5>üî¥ Custos (Para Pagar Contas)</h5>
                                    <div class="result-row">
                                        <span>Custos Diretos (Materiais):</span>
                                        <span id="res-custo-mat">R$ 0,00</span>
                                    </div>
                                    <div class="result-row">
                                        <span>Custos Indiretos (Fixos):</span>
                                        <span id="custo-indireto">R$ 0,00</span>
                                    </div>
                                    <div class="result-row subtotal-row">
                                        <span>Subtotal Custos:</span>
                                        <span id="subtotal">R$ 0,00</span>
                                    </div>
                                </div>

                                <!-- Bloco de M√£o de Obra (Sal√°rio da Artes√£) -->
                                <div class="result-section labor">
                                    <h5>üîµ M√£o de Obra (Seu Sal√°rio)</h5>
                                    <div class="result-row highlight-blue">
                                        <span>Valor pelo tempo trabalhado:</span>
                                        <span id="total-mao-de-obra">R$ 0,00</span>
                                    </div>
                                    <!-- Campos ocultos usados no JS antigo, mantidos para compatibilidade -->
                                    <span id="custo-mao-de-obra-detalhe" style="display:none;"></span>
                                    <span id="custo-ferias-13o-detalhe" style="display:none;"></span>
                                </div>

                                <!-- Bloco de Lucro (Crescimento da Empresa) -->
                                <div class="result-section profit">
                                    <h5>üü¢ Lucro (Para a Empresa)</h5>
                                    <div class="result-row highlight-green">
                                        <span>Margem L√≠quida:</span>
                                        <span id="margem-lucro-valor">R$ 0,00</span>
                                    </div>
                                </div>

                                <!-- Bloco de Taxas (Terceiros) -->
                                <div class="result-section fees">
                                    <div class="result-row">
                                        <span>Taxas (Cart√£o/Intermediadores):</span>
                                        <span id="taxa-credito-valor">R$ 0,00</span>
                                    </div>
                                    <!-- Valor "limpo" (Total sem taxas) -->
                                    <div class="result-row total-row-small">
                                        <span>Valor Real (Sem Taxas):</span>
                                        <span id="total-final">R$ 0,00</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Detalhes de custos indiretos (Oculto/Expans√≠vel) -->
                        <details class="details-ci">
                            <summary>Ver detalhe Custos Indiretos</summary>
                            <ul id="lista-custos-indiretos-detalhes"></ul>
                        </details>
                    </div>
                </div>
            </div>

            <!-- ABA: HIST√ìRICO - MODIFICADO -->
            <div id="precificacoes-geradas" class="subpagina" style="display:none;">
                <h2 class="section-title-lined">Hist√≥rico de Precifica√ß√µes</h2>
                <div class="form-group">
                    <input type="text" id="busca-precificacao" placeholder="Filtrar por produto..." onkeyup="buscarPrecificacoesGeradas()">
                </div>
                <div class="table-responsive">
                    <table id="tabela-precificacoes-geradas" class="tabela-gerada">
                        <!-- ATUALIZADO: Cabe√ßalhos ajustados (Removido Ano, Alterado Cliente->Produto) -->
                        <thead><tr><th>N¬∫</th><th>Produto</th><th>A√ß√µes</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

        </div>
    </section>

    <!-- SERVICE WORKER (Para PWA) -->
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('./sw.js')
            .then(reg => console.log('SW registrado!'))
            .catch(err => console.log('Falha SW:', err));
        });
      }
    </script>
</body>
</html>
